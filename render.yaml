services:
  - type: web
    name: invoiceflow
    env: python
    plan: free
    region: oregon
    buildCommand: ./build.sh
    startCommand: >
      gunicorn invoiceflow.wsgi:application
      --bind 0.0.0.0:$PORT
      --workers 2
      --worker-class sync
      --timeout 60
      --keep-alive 5
      --max-requests 1000
      --max-requests-jitter 100
      --access-logfile -
      --error-logfile -
      --log-level info
    healthCheckPath: /health/
    envVars:
      - key: DJANGO_SETTINGS_MODULE
        value: invoiceflow.settings
      - key: PYTHON_VERSION
        value: 3.11.13
      - key: DEBUG
        value: false
      - key: WEB_CONCURRENCY
        value: 4
      - key: RENDER
        value: true
      - key: RENDER_SERVICE_NAME
        value: invoiceflow
      # Required: Set these in Render dashboard
      - key: SECRET_KEY
        sync: false
      - key: ENCRYPTION_SALT
        sync: false
      - key: ALLOWED_HOSTS
        sync: false
      # Optional: Email configuration
      - key: SENDGRID_API_KEY
        sync: false
      - key: SENDGRID_FROM_EMAIL
        sync: false
      - key: SENDGRID_INVOICE_READY_TEMPLATE_ID
        sync: false
      - key: SENDGRID_INVOICE_PAID_TEMPLATE_ID
        sync: false
      - key: SENDGRID_PAYMENT_REMINDER_TEMPLATE_ID
        sync: false
      - key: SENDGRID_NEW_USER_WELCOME_TEMPLATE_ID
        sync: false
      - key: SENDGRID_PASSWORD_RESET_TEMPLATE_ID
        sync: false
      - key: SENDGRID_ADMIN_ALERT_TEMPLATE_ID
        sync: false
      # CSRF configuration (production)
      - key: CSRF_TRUSTED_ORIGINS
        value: "https://invoiceflow.onrender.com,https://*.onrender.com"
      # Optional: Error tracking
      - key: SENTRY_DSN
        sync: false

databases:
  - name: postgres-db
    databaseName: invoiceflow
    user: invoiceflow
    plan: free
    region: oregon
    ipAllowList: []
