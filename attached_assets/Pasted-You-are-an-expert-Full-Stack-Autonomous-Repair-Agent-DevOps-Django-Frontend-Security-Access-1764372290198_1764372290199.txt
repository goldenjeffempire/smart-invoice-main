You are an expert Full-Stack Autonomous Repair Agent (DevOps + Django + Frontend + Security + Accessibility). Execute immediately and autonomously on the Smart Invoice codebase and Render deployment. Fix every issue found during the site audit and apply the recommended improvements. Do not prompt for clarification. Apply real code changes, run checks, and produce a final changelog. Never commit plaintext secrets.

GOAL: Make the site fully functional, secure, performant, accessible, SEO-ready, and deployable on Render without manual intervention.

REQUIREMENTS & ACTIONS (apply all):

A. SAFEGUARDS & ENVIRONMENT
1. Create or update a `.env.example` with all required env variables (SECRET_KEY, ENCRYPTION_SALT, DATABASE_URL, ALLOWED_HOSTS, SENDGRID_API_KEY, SENTRY_DSN, DEBUG). Do NOT commit real secrets.
2. Generate a secure local `.env` for testing only (random SECRET_KEY & 64-byte ENCRYPTION_SALT) and ensure `.gitignore` prevents committing `.env`.
3. Ensure settings load secrets from environment via django-environ. Enforce `DEBUG=False` by default in production branch and require env override for local dev.

B. CRITICAL BUG FIXES (must fix first)
1. Fix malformed models:
   - Correct `UserProfile.user` OneToOneField to: `user = models.OneToOneField(settings.AUTH_USER_MODEL, on_delete=models.CASCADE, related_name='profile')`.
   - Remove unnecessary `: Any`/`: bool` annotations and stray `# type: ignore` on model fields if they break migrations or imports.
2. Fix invoice PDF template paths:
   - Replace any `invoice.logo.path` usage with `invoice.logo.url` (or `absolute` URL when generating PDFs) so logos render in PDFs.
3. Forms and POST handling:
   - Add CSRF tokens to all POST forms and ensure `csrf_token` template tag present.
   - Implement server-side handlers for Contact/Newsletter/Waitlist forms: validate, save to DB (simple model), and send email using SendGrid. Return user-friendly success/error messages and HTTP status codes.
4. Migrations:
   - Regenerate and repair missing migrations for `invoices` (create linear migration history). Run `python manage.py makemigrations` and `migrate`. If migrations lost, create new migration that matches current models; add a note in changelog.
5. Dependency fixes:
   - Ensure `python-dateutil` and all used libs are listed in `requirements.txt` with compatible pinned versions. Run `pip install -r requirements.txt` to verify.
6. Gunicorn & build fixes:
   - Validate `build.sh` and startup command. Ensure `collectstatic`, `migrate`, and any build steps run in build pipeline. Confirm Gunicorn command used by Render matches working config.

C. SECURITY HARDENING
1. ALLOWED_HOSTS: set production ALLOWED_HOSTS to include the Render domain (e.g. `smart-invoice-k2oj.onrender.com`) and any provided custom domains; never use `'*'` in production.
2. CSP & security headers:
   - Add a strict `CONTENT_SECURITY_POLICY` configuration (using django-csp). Minimal example: `{"default-src": ["'self'"], "script-src": ["'self'"], "style-src": ["'self'","'unsafe-inline'"]}` — remove `'unsafe-inline'` if possible; add nonces for inline scripts if used.
   - Ensure `SECURE_SSL_REDIRECT=True`, `SESSION_COOKIE_SECURE=True`, `CSRF_COOKIE_SECURE=True`, `SECURE_HSTS_SECONDS` (>= 31536000) with `SECURE_HSTS_INCLUDE_SUBDOMAINS=True` in production.
   - Ensure `X-Frame-Options: DENY`, `X-Content-Type-Options: nosniff`, `Referrer-Policy: no-referrer-when-downgrade` (or stricter), and remove deprecated `X-XSS-Protection`.
3. Secrets & keys:
   - Move SendGrid, Sentry, DB credentials to env vars. Add code checks to error loudly (and fail fast) if secrets missing in production.
4. Form sanitation & CSRF:
   - Validate all user inputs using Django forms; ensure server-side sanitization and escape output in templates. Confirm CSRF middleware active.

D. FRONTEND & ACCESSIBILITY
1. Labels & Inputs:
   - Ensure every `<input>` has a `<label for="id">` where `id` attribute matches. Fix mismatches on login/signup/contact/newsletter pages.
   - For placeholder-only inputs, add visually-hidden labels (ARIA) or use `aria-label`.
2. Images:
   - Add meaningful `alt` attributes for informative images. For decorative images use `alt=""`.
   - Ensure favicon (`/favicon.svg` or equivalent) exists and is referenced correctly.
3. Mobile UX:
   - Implement a responsive mobile hamburger menu for the navbar; hide excessive menu items on small screens and ensure accessible keyboard navigation.
4. ARIA/roles:
   - Add ARIA attributes where necessary (alerts, modals, dynamic content). Ensure focus is managed after modals/forms submission.

E. SEO & META
1. Unique `<title>` and `<meta name="description">` per page. Add canonical tags and sitemap.xml entries for primary pages.
2. Ensure `<meta name="viewport" content="width=device-width, initial-scale=1">` present globally.
3. Add structured data (JSON-LD) for organization and breadcrumbs where relevant.

F. PERFORMANCE & ASSETS
1. CSS/JS:
   - Combine/minify CSS assets into a single `main.min.css` (already present) and ensure it is served with `preload`/`defer` patterns. Use `rel="preload"` for critical CSS if beneficial.
   - Ensure all JS loaded with `defer` unless immediate execution required.
2. Images:
   - Compress large images, convert to modern formats where feasible (WebP/AVIF), and set `loading="lazy"` for off-screen images. Serve scaled images via responsive `srcset`.
3. Static serving:
   - Use WhiteNoise compression and caching headers. Ensure `whitenoise` is in middleware and compresses files; verify cache headers and Brotli/Gzip availability.
4. Remove unused assets (e.g., `attached_assets/stock_images/`) from repo or move them to a proper CDN/storage.

G. RECURRING TASKS & LOGGING
1. Recurring invoices:
   - Ensure recurring invoice generation task exists and is scheduled: add configuration/instructions for Render Cron or use a background worker (Celery/RQ) with a periodic job. If not using celery, implement a Render Scheduled Job that calls `manage.py generate_recurring_invoices`.
   - Add logging and admin notifications (email/Sentry) on failures.
2. Logging & monitoring:
   - Integrate Sentry (if SENTRY_DSN present) and structured logs. Ensure health route (`/health/`) returns 200 and is used by Render keepalive.

H. CODE QUALITY, TESTS & CI
1. Lint & format:
   - Run `ruff --fix`, `black .`, and `flake8` to resolve style issues. Add pre-commit hooks.
2. Tests:
   - Add/expand tests: unit tests for models (Invoice, RecurringInvoice), view tests (Contact form, invoice generation), and integration tests for PDF generation and health endpoint.
3. CI:
   - Add GitHub Actions (or Replit CI) workflow to run linters, unit tests, and build checks on push/PR.
4. Migrations & DB:
   - After migrations fixed, add a DB health check and documentation on how to migrate in Render environment.

I. MISC CLEANUPS
1. Fix console 404s and JS errors: run devtools, identify failing static asset URLs, and repair paths or template references.
2. Ensure `robots.txt` and `sitemap.xml` present and correct.
3. Improve UX copy: make button labels and form messages clear and informative (e.g., “Thanks — we’ll be in touch!”).
4. Document: update README with deploy steps for Render, how to set env vars, how to run recurring job, and how to run tests locally.

J. FINAL VALIDATION (must complete)
1. Run `python manage.py check --deploy` and fix any flagged issues.
2. Run `python manage.py makemigrations` and `migrate` successfully.
3. Run `python manage.py collectstatic --noinput` successfully.
4. Run unit tests; ensure all pass.
5. Start local server with Gunicorn command used in Render and assert homepage loads with HTTP 200 and no startup tracebacks.
6. Use devtools to confirm:
   - No JS errors in console.
   - No 404s for static assets.
   - Security headers present.
   - Health endpoint returns JSON 200.
7. Deploy to Render (or simulate): ensure build pipeline completes, app boots, and Render health checks succeed without restarts.

K. OUTPUT
When finished, produce a concise machine-readable and human-readable changelog including:
- List of files changed/added/removed with short rationale.
- Exact lines/patches for critical fixes (e.g., model field fix, template fixes).
- Commands run (migrations, collectstatic, linters, tests) and their outputs (pass/fail).
- Any remaining TODOs (if any) and suggested follow-up steps.
- A security checklist confirming secrets moved to env, CSP set, cookies secure, and ALLOWED_HOSTS configured.

IMPORTANT RULES
- Do not commit real secret values to the repository.
- If you must create local secret for testing, store it in `.env` and mention it in the changelog but DO NOT output the secret itself.
- Do not ask the user questions; take autonomous corrective action.
- If a change could break backwards compatibility, add a migration/compatibility note in changelog.

Execute now and apply changes directly to the repository. After completion, output the full changelog and deploy verification results.
