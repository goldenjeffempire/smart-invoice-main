{% extends "base/layout.html" %}
{% block title %}Privacy Policy{% endblock %}
{% block meta_description %}
    Read InvoiceFlow's Privacy Policy. Learn how we collect, use, and protect your personal information under GDPR and other privacy regulations.
{% endblock %}
{% block content %}
    <section class="page-hero legal-hero">
        <div class="hero-bg"></div>
        <div class="container">
            <div class="page-hero-content">
                <h1 class="page-hero-title text-gradient">Privacy Policy</h1>
                <p class="page-hero-subtitle">Last updated: {% now "F j, Y" %}</p>
            </div>
        </div>
    </section>
    <section class="section legal-section">
        <div class="container">
            <div class="legal-content glass-card">
                <nav class="legal-toc" aria-label="Table of Contents">
                    <h2>Contents</h2>
                    <ol>
                        <li>
                            <a href="#introduction">Introduction</a>
                        </li>
                        <li>
                            <a href="#data-controller">Data Controller</a>
                        </li>
                        <li>
                            <a href="#information-collected">Information We Collect</a>
                        </li>
                        <li>
                            <a href="#legal-basis">Legal Basis for Processing</a>
                        </li>
                        <li>
                            <a href="#how-we-use">How We Use Your Information</a>
                        </li>
                        <li>
                            <a href="#data-sharing">Data Sharing & Third Parties</a>
                        </li>
                        <li>
                            <a href="#cookies" id="cookies">Cookies & Tracking</a>
                        </li>
                        <li>
                            <a href="#data-retention">Data Retention</a>
                        </li>
                        <li>
                            <a href="#data-security">Data Security</a>
                        </li>
                        <li>
                            <a href="#your-rights">Your Rights (GDPR)</a>
                        </li>
                        <li>
                            <a href="#international-transfers">International Data Transfers</a>
                        </li>
                        <li>
                            <a href="#children">Children's Privacy</a>
                        </li>
                        <li>
                            <a href="#changes">Changes to This Policy</a>
                        </li>
                        <li>
                            <a href="#contact">Contact Us</a>
                        </li>
                    </ol>
                </nav>
                <div class="legal-block" id="introduction">
                    <h2>1. Introduction</h2>
                    <p>
                        InvoiceFlow ("we," "our," or "us") is committed to protecting your privacy. This Privacy Policy explains how we collect, use, disclose, and safeguard your information when you use our invoicing platform at invoiceflow.com.ng (the "Service").
                    </p>
                    <p>
                        We comply with the General Data Protection Regulation (GDPR), the Nigeria Data Protection Regulation (NDPR), and other applicable data protection laws. By using our Service, you agree to the collection and use of information in accordance with this policy.
                    </p>
                </div>
                <div class="legal-block" id="data-controller">
                    <h2>2. Data Controller</h2>
                    <p>
                        InvoiceFlow is the data controller responsible for your personal data. For any questions about this policy or our data practices, contact:
                    </p>
                    <address>
                        <strong>InvoiceFlow Data Protection</strong>
                        <br>
                        Email: privacy@invoiceflow.com.ng
                        <br>
                        Address: Lagos, Nigeria
                    </address>
                </div>
                <div class="legal-block" id="information-collected">
                    <h2>3. Information We Collect</h2>
                    <h3>3.1 Information You Provide</h3>
                    <ul>
                        <li>
                            <strong>Account Information:</strong> Name, email address, password (hashed), company name, business address
                        </li>
                        <li>
                            <strong>Invoice Data:</strong> Client names, addresses, email addresses, invoice items, payment information
                        </li>
                        <li>
                            <strong>Payment Information:</strong> Billing address, payment method details (processed by our payment providers)
                        </li>
                        <li>
                            <strong>Communications:</strong> Messages sent through our contact forms or support channels
                        </li>
                    </ul>
                    <h3>3.2 Automatically Collected Information</h3>
                    <ul>
                        <li>
                            <strong>Usage Data:</strong> Pages visited, features used, time spent on the Service
                        </li>
                        <li>
                            <strong>Device Information:</strong> IP address, browser type, operating system, device identifiers
                        </li>
                        <li>
                            <strong>Cookies:</strong> See our Cookie Policy section below
                        </li>
                    </ul>
                </div>
                <div class="legal-block" id="legal-basis">
                    <h2>4. Legal Basis for Processing (GDPR Article 6)</h2>
                    <p>We process your personal data based on the following legal grounds:</p>
                    <ul>
                        <li>
                            <strong>Contract Performance:</strong> Processing necessary to provide our invoicing services to you
                        </li>
                        <li>
                            <strong>Legitimate Interests:</strong> Improving our services, fraud prevention, security
                        </li>
                        <li>
                            <strong>Consent:</strong> Marketing communications, analytics cookies (where required)
                        </li>
                        <li>
                            <strong>Legal Obligations:</strong> Compliance with tax, accounting, and legal requirements
                        </li>
                    </ul>
                </div>
                <div class="legal-block" id="how-we-use">
                    <h2>5. How We Use Your Information</h2>
                    <ul>
                        <li>Provide, maintain, and improve our invoicing platform</li>
                        <li>Process transactions and send transaction notifications</li>
                        <li>Send administrative emails (account updates, security alerts)</li>
                        <li>Respond to your inquiries and provide customer support</li>
                        <li>Analyze usage patterns to improve user experience</li>
                        <li>Detect, prevent, and address technical issues and fraud</li>
                        <li>Comply with legal obligations and enforce our terms</li>
                    </ul>
                </div>
                <div class="legal-block" id="data-sharing">
                    <h2>6. Data Sharing & Third Parties</h2>
                    <p>We do not sell your personal data. We may share data with:</p>
                    <h3>6.1 Service Providers (Subprocessors)</h3>
                    <ul>
                        <li>
                            <strong>Hosting:</strong> Render.com / Replit (cloud infrastructure)
                        </li>
                        <li>
                            <strong>Email:</strong> SendGrid (transactional emails)
                        </li>
                        <li>
                            <strong>Error Tracking:</strong> Sentry (application monitoring)
                        </li>
                        <li>
                            <strong>Payment Processing:</strong> Stripe (payment transactions)
                        </li>
                    </ul>
                    <p>All subprocessors are bound by Data Processing Agreements (DPAs) that comply with GDPR requirements.</p>
                    <h3>6.2 Legal Requirements</h3>
                    <p>We may disclose your information if required by law, court order, or to protect our rights and safety.</p>
                </div>
                <div class="legal-block" id="cookies">
                    <h2>7. Cookies & Tracking Technologies</h2>
                    <h3>7.1 Essential Cookies (Always Active)</h3>
                    <p>These cookies are necessary for the website to function:</p>
                    <ul>
                        <li>
                            <strong>csrftoken:</strong> Security token to prevent cross-site request forgery
                        </li>
                        <li>
                            <strong>sessionid:</strong> Session management for logged-in users
                        </li>
                        <li>
                            <strong>invoiceflow_cookie_consent:</strong> Stores your cookie preferences
                        </li>
                    </ul>
                    <h3>7.2 Analytics Cookies (Optional)</h3>
                    <p>
                        With your consent, we may use analytics cookies to understand how visitors interact with our website. These are only set after you provide explicit consent.
                    </p>
                    <h3>7.3 Managing Cookies</h3>
                    <p>You can manage your cookie preferences at any time using the cookie banner or by clicking the button below:</p>
                    <button type="button"
                            class="btn btn-secondary"
                            onclick="document.getElementById('cookie-consent-banner').style.display='block';">
                        Manage Cookie Preferences
                    </button>
                </div>
                <div class="legal-block" id="data-retention">
                    <h2>8. Data Retention</h2>
                    <p>We retain your personal data only as long as necessary:</p>
                    <ul>
                        <li>
                            <strong>Account Data:</strong> Until account deletion + 30 days for backup recovery
                        </li>
                        <li>
                            <strong>Invoice Data:</strong> 7 years (legal/tax requirements in most jurisdictions)
                        </li>
                        <li>
                            <strong>Contact Form Submissions:</strong> 2 years
                        </li>
                        <li>
                            <strong>Log Files:</strong> 90 days
                        </li>
                    </ul>
                </div>
                <div class="legal-block" id="data-security">
                    <h2>9. Data Security</h2>
                    <p>We implement industry-standard security measures:</p>
                    <ul>
                        <li>TLS 1.2+ encryption for all data in transit</li>
                        <li>AES-256 encryption for sensitive data at rest</li>
                        <li>Regular security audits and penetration testing</li>
                        <li>Access controls and authentication requirements</li>
                        <li>Incident response procedures</li>
                    </ul>
                </div>
                <div class="legal-block" id="your-rights">
                    <h2>10. Your Rights Under GDPR</h2>
                    <p>As a data subject, you have the following rights:</p>
                    <div class="rights-grid">
                        <div class="right-item">
                            <h4>Right of Access (Article 15)</h4>
                            <p>Request a copy of your personal data we hold.</p>
                        </div>
                        <div class="right-item">
                            <h4>Right to Rectification (Article 16)</h4>
                            <p>Request correction of inaccurate personal data.</p>
                        </div>
                        <div class="right-item">
                            <h4>Right to Erasure (Article 17)</h4>
                            <p>Request deletion of your personal data ("right to be forgotten").</p>
                        </div>
                        <div class="right-item">
                            <h4>Right to Restrict Processing (Article 18)</h4>
                            <p>Request limitation of how we process your data.</p>
                        </div>
                        <div class="right-item">
                            <h4>Right to Data Portability (Article 20)</h4>
                            <p>Receive your data in a machine-readable format.</p>
                        </div>
                        <div class="right-item">
                            <h4>Right to Object (Article 21)</h4>
                            <p>Object to processing based on legitimate interests.</p>
                        </div>
                        <div class="right-item">
                            <h4>Right to Withdraw Consent</h4>
                            <p>Withdraw consent at any time (where processing is based on consent).</p>
                        </div>
                    </div>
                    <h3>Exercising Your Rights</h3>
                    {% if user.is_authenticated %}
                        <p>As a logged-in user, you can exercise your rights directly:</p>
                        <div class="gdpr-actions">
                            <a href="{% url 'gdpr_export' %}" class="btn btn-secondary">Export My Data</a>
                            <button type="button" class="btn btn-secondary" onclick="submitSAR()">Submit Access Request</button>
                            <button type="button"
                                    class="btn btn-secondary btn-danger-outline"
                                    onclick="requestDeletion()">Request Data Deletion</button>
                        </div>
                    {% else %}
                        <p>
                            To exercise your rights, please <a href="{% url 'login' %}">log in to your account</a> or contact us at privacy@invoiceflow.com.ng with proof of identity.
                        </p>
                    {% endif %}
                    <p>
                        We will respond to your request within 30 days. If you are not satisfied with our response, you have the right to lodge a complaint with a supervisory authority.
                    </p>
                </div>
                <div class="legal-block" id="international-transfers">
                    <h2>11. International Data Transfers</h2>
                    <p>
                        Your data may be transferred to and processed in countries outside your country of residence. We ensure appropriate safeguards are in place, including:
                    </p>
                    <ul>
                        <li>Standard Contractual Clauses (SCCs) approved by the European Commission</li>
                        <li>Data Processing Agreements with all subprocessors</li>
                        <li>Adequacy decisions where applicable</li>
                    </ul>
                </div>
                <div class="legal-block" id="children">
                    <h2>12. Children's Privacy</h2>
                    <p>
                        Our Service is not intended for children under 16. We do not knowingly collect personal data from children. If you believe we have collected data from a child, please contact us immediately.
                    </p>
                </div>
                <div class="legal-block" id="changes">
                    <h2>13. Changes to This Policy</h2>
                    <p>
                        We may update this Privacy Policy from time to time. We will notify you of any material changes by posting the new policy on this page and updating the "last updated" date. For significant changes, we will send an email notification.
                    </p>
                </div>
                <div class="legal-block" id="contact">
                    <h2>14. Contact Us</h2>
                    <p>For any questions about this Privacy Policy or to exercise your data rights, please contact:</p>
                    <address>
                        <strong>InvoiceFlow Privacy Team</strong>
                        <br>
                        Email: privacy@invoiceflow.com.ng
                        <br>
                        Or use our <a href="{% url 'contact' %}">secure contact form</a>
                    </address>
                </div>
            </div>
        </div>
    </section>
    <script>
function submitSAR() {
    if (confirm('This will submit a Subject Access Request. We will respond within 30 days. Continue?')) {
        fetch('{% url "gdpr_sar" %}', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': '{{ csrf_token }}'
            },
            body: JSON.stringify({ details: 'Full data access request from privacy page' })
        })
        .then(r => r.json())
        .then(data => {
            alert(data.message || data.error);
        })
        .catch(() => alert('An error occurred. Please try again.'));
    }
}

function requestDeletion() {
    if (confirm('WARNING: This will request permanent deletion of your account and all data. This action cannot be undone. Are you sure?')) {
        fetch('{% url "gdpr_delete" %}', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': '{{ csrf_token }}'
            }
        })
        .then(r => r.json())
        .then(data => {
            alert(data.message || data.error);
        })
        .catch(() => alert('An error occurred. Please try again.'));
    }
}
    </script>
{% endblock %}
{% block extra_css %}
    <style>
.legal-hero {
    padding: var(--spacing-32) 0 var(--spacing-12);
    text-align: center;
}

.legal-hero .page-hero-title {
    font-size: var(--font-size-4xl);
}

.legal-hero .page-hero-subtitle {
    font-size: var(--font-size-base);
    color: var(--color-neutral-500);
}

.legal-section {
    padding-top: 0;
}

.legal-content {
    max-width: 900px;
    margin: 0 auto;
    padding: var(--spacing-10);
}

.legal-toc {
    background: rgba(99, 102, 241, 0.05);
    border: 1px solid rgba(99, 102, 241, 0.1);
    border-radius: var(--radius-xl);
    padding: var(--spacing-6);
    margin-bottom: var(--spacing-10);
}

.legal-toc h2 {
    font-size: var(--font-size-lg);
    color: var(--color-neutral-0);
    margin-bottom: var(--spacing-4);
}

.legal-toc ol {
    columns: 2;
    column-gap: var(--spacing-8);
    padding-left: var(--spacing-6);
}

@media (max-width: 640px) {
    .legal-toc ol {
        columns: 1;
    }
}

.legal-toc li {
    margin-bottom: var(--spacing-2);
}

.legal-toc a {
    color: var(--color-primary-400);
    text-decoration: none;
}

.legal-toc a:hover {
    text-decoration: underline;
}

.legal-block {
    margin-bottom: var(--spacing-10);
    scroll-margin-top: 100px;
}

.legal-block:last-child {
    margin-bottom: 0;
}

.legal-block h2 {
    font-size: var(--font-size-xl);
    color: var(--color-neutral-0);
    margin-bottom: var(--spacing-4);
    padding-bottom: var(--spacing-2);
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
}

.legal-block h3 {
    font-size: var(--font-size-lg);
    color: var(--color-neutral-200);
    margin: var(--spacing-6) 0 var(--spacing-3);
}

.legal-block h4 {
    font-size: var(--font-size-base);
    color: var(--color-neutral-100);
    margin-bottom: var(--spacing-2);
}

.legal-block p, .legal-block li {
    font-size: var(--font-size-base);
    color: var(--color-neutral-400);
    line-height: var(--line-height-relaxed);
}

.legal-block ul, .legal-block ol {
    padding-left: var(--spacing-6);
    margin: var(--spacing-4) 0;
}

.legal-block li {
    margin-bottom: var(--spacing-2);
}

.legal-block address {
    font-style: normal;
    background: rgba(255, 255, 255, 0.05);
    padding: var(--spacing-4);
    border-radius: var(--radius-lg);
    color: var(--color-neutral-300);
    margin-top: var(--spacing-4);
}

.rights-grid {
    display: grid;
    gap: var(--spacing-4);
    margin: var(--spacing-6) 0;
}

@media (min-width: 640px) {
    .rights-grid {
        grid-template-columns: repeat(2, 1fr);
    }
}

.right-item {
    background: rgba(255, 255, 255, 0.03);
    border: 1px solid rgba(255, 255, 255, 0.08);
    border-radius: var(--radius-lg);
    padding: var(--spacing-4);
}

.right-item h4 {
    color: var(--color-primary-400);
}

.right-item p {
    font-size: var(--font-size-sm);
    margin: 0;
}

.gdpr-actions {
    display: flex;
    flex-wrap: wrap;
    gap: var(--spacing-3);
    margin: var(--spacing-6) 0;
}

.btn-danger-outline {
    border-color: #ef4444;
    color: #ef4444;
}

.btn-danger-outline:hover {
    background: rgba(239, 68, 68, 0.1);
}
    </style>
{% endblock %}
