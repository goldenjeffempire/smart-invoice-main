{% extends "base/layout.html" %}
{% load static %}
{% block title %}Two-Factor Authentication Enabled - InvoiceFlow{% endblock %}
{% block meta_description %}Your account is now protected with two-factor authentication.{% endblock %}
{% block body_class %}auth-page{% endblock %}
{% block nav %}{% endblock %}
{% block footer %}{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/auth.css' %}">
{% endblock %}

{% block content %}
<div class="auth-bg"></div>
<div class="auth-glow"></div>
<div class="auth-container" style="max-width: 520px;">
    <div class="auth-card">
        <div class="auth-header">
            <div class="success-icon-large">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                    <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/>
                    <polyline points="22 4 12 14.01 9 11.01"/>
                </svg>
            </div>
            <h1 class="auth-title">Two-Factor Authentication Enabled</h1>
            <p class="auth-subtitle">Your account is now more secure</p>
        </div>

        <div class="recovery-codes-section">
            <h2 class="recovery-codes-title">Recovery Codes</h2>
            <div class="auth-alert warning" role="alert">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                    <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/>
                    <line x1="12" y1="9" x2="12" y2="13"/>
                    <line x1="12" y1="17" x2="12.01" y2="17"/>
                </svg>
                <span>Save these codes in a safe place. You can use them to access your account if you lose access to your authenticator app.</span>
            </div>
            <div class="recovery-codes">
                {% for code in recovery_codes %}
                    <div class="recovery-code">{{ code }}</div>
                {% endfor %}
            </div>
            <div class="recovery-actions">
                <button type="button" class="btn-auth btn-secondary" id="downloadBtn">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                        <polyline points="7 10 12 15 17 10"/>
                        <line x1="12" y1="15" x2="12" y2="3"/>
                    </svg>
                    <span>Download</span>
                </button>
                <button type="button" class="btn-auth btn-secondary" id="copyBtn">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                        <rect x="9" y="9" width="13" height="13" rx="2" ry="2"/>
                        <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/>
                    </svg>
                    <span>Copy</span>
                </button>
            </div>
        </div>

        <a href="{% url 'dashboard' %}" class="btn-auth">
            <span class="btn-text">Continue to Dashboard</span>
            <svg class="btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                <line x1="5" y1="12" x2="19" y2="12"/>
                <polyline points="12 5 19 12 12 19"/>
            </svg>
        </a>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const recoveryCodes = [{% for code in recovery_codes %}"{{ code }}"{% if not forloop.last %}, {% endif %}{% endfor %}];
    
    document.getElementById('downloadBtn').addEventListener('click', function() {
        const content = "InvoiceFlow Recovery Codes\n" +
                       "========================\n\n" +
                       "Keep these codes safe. Each code can only be used once.\n\n" +
                       recoveryCodes.join("\n");
        
        const blob = new Blob([content], { type: 'text/plain' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'invoiceflow-recovery-codes.txt';
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
    });
    
    document.getElementById('copyBtn').addEventListener('click', function() {
        const btn = this;
        const codesText = recoveryCodes.join('\n');
        navigator.clipboard.writeText(codesText).then(() => {
            const originalHTML = btn.innerHTML;
            btn.innerHTML = '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"/></svg><span>Copied!</span>';
            setTimeout(() => {
                btn.innerHTML = originalHTML;
            }, 2000);
        });
    });
});
</script>
{% endblock %}
