{% extends "base/layout.html" %}

{% block title %}Verify Two-Factor Authentication{% endblock %}
{% block meta_description %}Enter your 2FA code to continue logging in.{% endblock %}

{% block content %}
<section class="section">
    <div class="container">
        <div class="auth-container">
            <div class="glass-card auth-card">
                <div class="auth-header">
                    <div class="mfa-lock-icon">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/>
                        </svg>
                    </div>
                    <h1 class="auth-title">Two-Factor Authentication</h1>
                    <p class="auth-subtitle">Enter the 6-digit code from your authenticator app</p>
                </div>

                {% if error %}
                <div class="alert alert-error">
                    {{ error }}
                </div>
                {% endif %}

                <form method="post" class="mfa-form">
                    {% csrf_token %}
                    <div class="form-group">
                        <input type="text" 
                               name="token" 
                               class="form-control mfa-code-input" 
                               placeholder="000000"
                               pattern="[0-9]{6}" 
                               maxlength="6"
                               inputmode="numeric"
                               autocomplete="one-time-code"
                               autofocus
                               required>
                    </div>
                    <button type="submit" class="btn btn-primary btn-full">Verify</button>
                </form>

                <div class="recovery-section">
                    <button type="button" class="link-button" onclick="toggleRecovery()">
                        Use a recovery code instead
                    </button>
                    
                    <form method="post" class="recovery-form" id="recoveryForm" style="display: none;">
                        {% csrf_token %}
                        <div class="form-group">
                            <label for="recovery_code">Recovery Code</label>
                            <input type="text" 
                                   name="recovery_code" 
                                   id="recovery_code"
                                   class="form-control" 
                                   placeholder="XXXX-XXXX"
                                   pattern="[A-Z0-9]{4}-[A-Z0-9]{4}"
                                   maxlength="9">
                        </div>
                        <button type="submit" class="btn btn-secondary btn-full">Use Recovery Code</button>
                    </form>
                </div>

                <div class="auth-footer">
                    <a href="{% url 'logout' %}" class="link-secondary">Cancel and log out</a>
                </div>
            </div>
        </div>
    </div>
</section>

<script>
function toggleRecovery() {
    const form = document.getElementById('recoveryForm');
    form.style.display = form.style.display === 'none' ? 'block' : 'none';
}
</script>
{% endblock %}

{% block extra_css %}
<style>
.auth-container {
    max-width: 400px;
    margin: 0 auto;
    padding: var(--spacing-12) 0;
}

.auth-card {
    padding: var(--spacing-8);
}

.auth-header {
    text-align: center;
    margin-bottom: var(--spacing-8);
}

.mfa-lock-icon {
    width: 64px;
    height: 64px;
    background: rgba(99, 102, 241, 0.1);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    margin: 0 auto var(--spacing-4);
}

.mfa-lock-icon svg {
    width: 32px;
    height: 32px;
    color: var(--color-primary-500);
}

.auth-title {
    font-size: var(--font-size-xl);
    color: var(--color-neutral-0);
    margin-bottom: var(--spacing-2);
}

.auth-subtitle {
    color: var(--color-neutral-400);
    font-size: var(--font-size-sm);
}

.mfa-form {
    margin-bottom: var(--spacing-6);
}

.mfa-code-input {
    text-align: center;
    font-size: var(--font-size-2xl);
    letter-spacing: 0.5em;
    padding: var(--spacing-4);
}

.recovery-section {
    text-align: center;
    margin-bottom: var(--spacing-6);
}

.link-button {
    background: none;
    border: none;
    color: var(--color-primary-400);
    cursor: pointer;
    font-size: var(--font-size-sm);
}

.link-button:hover {
    text-decoration: underline;
}

.recovery-form {
    margin-top: var(--spacing-4);
}

.auth-footer {
    text-align: center;
    padding-top: var(--spacing-6);
    border-top: 1px solid rgba(255, 255, 255, 0.1);
}

.alert-error {
    background: rgba(239, 68, 68, 0.1);
    color: #ef4444;
    padding: var(--spacing-3) var(--spacing-4);
    border-radius: var(--radius-lg);
    margin-bottom: var(--spacing-6);
    text-align: center;
}
</style>
{% endblock %}
