{% extends "base/layout.html" %}
{% load static %}
{% block title %}Templates{% endblock %}
{% block body_class %}dashboard-light-page{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/dashboard-light.css' %}">
<style>
.template-grid-light {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
    gap: 24px;
}

.template-card-light {
    background: var(--light-bg-secondary);
    border-radius: var(--light-radius-xl);
    border: 1px solid var(--light-border-primary);
    padding: 24px;
    transition: all 0.3s ease;
}

.template-card-light:hover {
    border-color: var(--light-primary);
    box-shadow: var(--light-shadow-lg);
    transform: translateY(-4px);
}

.template-header-light {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 16px;
}

.template-name-light {
    font-size: 1.125rem;
    font-weight: 600;
    color: var(--light-text-primary);
    margin: 0 0 4px 0;
}

.template-business-light {
    font-size: 0.875rem;
    color: var(--light-text-tertiary);
}

.template-description-light {
    font-size: 0.875rem;
    color: var(--light-text-secondary);
    margin-bottom: 16px;
    line-height: 1.5;
}

.template-meta-light {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding-top: 16px;
    border-top: 1px solid var(--light-border-primary);
}

.template-info-light {
    font-size: 0.8125rem;
    color: var(--light-text-muted);
}

.template-actions-light {
    display: flex;
    gap: 8px;
}

.template-action-light {
    width: 32px;
    height: 32px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: var(--light-bg-tertiary);
    border: none;
    border-radius: var(--light-radius-md);
    color: var(--light-text-tertiary);
    cursor: pointer;
    text-decoration: none;
    transition: all 0.2s ease;
}

.template-action-light:hover {
    background: var(--light-primary-light);
    color: var(--light-primary);
}

.template-action-light svg {
    width: 16px;
    height: 16px;
}

.template-form-light {
    background: var(--light-bg-secondary);
    border-radius: var(--light-radius-xl);
    border: 1px solid var(--light-border-primary);
    padding: 24px;
    margin-bottom: 32px;
}

.template-form-header-light {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 24px;
    padding-bottom: 16px;
    border-bottom: 1px solid var(--light-border-primary);
}

.template-form-title-light {
    font-size: 1.125rem;
    font-weight: 600;
    color: var(--light-text-primary);
    margin: 0;
}
</style>
{% endblock %}

{% block nav %}{% endblock %}
{% block footer %}{% endblock %}

{% block content %}
<div class="dashboard-light">
    {% include 'components/sidebar-light.html' with active='templates' %}
    
    <main class="dashboard-light-main">
        <header class="dashboard-light-header">
            <div class="dashboard-light-header-content">
                <h1>Templates</h1>
                <p>Save and reuse invoice templates for faster invoicing</p>
            </div>
            <div class="dashboard-light-actions">
                <button type="button" class="btn-light-primary" onclick="document.getElementById('template-form').classList.toggle('hidden')">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="12" y1="5" x2="12" y2="19"/>
                        <line x1="5" y1="12" x2="19" y2="12"/>
                    </svg>
                    Create Template
                </button>
            </div>
        </header>
        
        <div id="template-form" class="template-form-light hidden">
            <div class="template-form-header-light">
                <h2 class="template-form-title-light">Create New Template</h2>
                <button type="button" onclick="document.getElementById('template-form').classList.add('hidden')" style="background: none; border: none; cursor: pointer; color: var(--light-text-tertiary);">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width: 20px; height: 20px;">
                        <line x1="18" y1="6" x2="6" y2="18"/>
                        <line x1="6" y1="6" x2="18" y2="18"/>
                    </svg>
                </button>
            </div>
            <form method="post">
                {% csrf_token %}
                <div class="form-light-grid" style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px;">
                    <div class="form-light-group">
                        <label class="form-light-label">Template Name</label>
                        <input type="text" name="name" class="form-light-input" required>
                    </div>
                    <div class="form-light-group">
                        <label class="form-light-label">Description</label>
                        <input type="text" name="description" class="form-light-input">
                    </div>
                    <div class="form-light-group">
                        <label class="form-light-label">Business Name</label>
                        <input type="text" name="business_name" class="form-light-input">
                    </div>
                    <div class="form-light-group">
                        <label class="form-light-label">Business Email</label>
                        <input type="email" name="business_email" class="form-light-input">
                    </div>
                    <div class="form-light-group">
                        <label class="form-light-label">Currency</label>
                        <select name="currency" class="form-light-select">
                            <option value="USD">USD ($)</option>
                            <option value="EUR">EUR (&euro;)</option>
                            <option value="GBP">GBP (&pound;)</option>
                            <option value="NGN">NGN (&#8358;)</option>
                        </select>
                    </div>
                    <div class="form-light-group">
                        <label class="form-light-label">Tax Rate (%)</label>
                        <input type="number" name="tax_rate" class="form-light-input" step="0.01" min="0" max="100" value="0">
                    </div>
                </div>
                <div style="margin-top: 24px; display: flex; justify-content: flex-end; gap: 12px;">
                    <button type="button" class="btn-light-secondary" onclick="document.getElementById('template-form').classList.add('hidden')">Cancel</button>
                    <button type="submit" class="btn-light-primary">Save Template</button>
                </div>
            </form>
        </div>
        
        {% if templates %}
        <div class="template-grid-light">
            {% for template in templates %}
            <div class="template-card-light">
                <div class="template-header-light">
                    <div>
                        <h3 class="template-name-light">{{ template.name }}</h3>
                        <span class="template-business-light">{{ template.business_name }}</span>
                    </div>
                    {% if template.is_default %}
                    <span class="badge-light badge-paid">Default</span>
                    {% endif %}
                </div>
                <p class="template-description-light">{{ template.description|default:"No description" }}</p>
                <div class="template-meta-light">
                    <span class="template-info-light">{{ template.currency }} | {{ template.tax_rate }}% tax</span>
                    <div class="template-actions-light">
                        <a href="{% url 'create_invoice' %}?template={{ template.id }}" class="template-action-light" title="Use Template">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="12" cy="12" r="10"/>
                                <line x1="12" y1="8" x2="12" y2="16"/>
                                <line x1="8" y1="12" x2="16" y2="12"/>
                            </svg>
                        </a>
                        <a href="{% url 'delete_template' template.id %}" class="template-action-light" title="Delete">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polyline points="3 6 5 6 21 6"/>
                                <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
                            </svg>
                        </a>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
        {% else %}
        <div class="card-light">
            <div class="card-light-body">
                <div class="empty-light-state">
                    <div class="empty-light-icon">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                            <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
                            <line x1="3" y1="9" x2="21" y2="9"/>
                            <line x1="9" y1="21" x2="9" y2="9"/>
                        </svg>
                    </div>
                    <h3 class="empty-light-title">No templates yet</h3>
                    <p class="empty-light-description">Create reusable templates to speed up your invoicing workflow.</p>
                    <button type="button" class="btn-light-primary" onclick="document.getElementById('template-form').classList.remove('hidden')">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="12" y1="5" x2="12" y2="19"/>
                            <line x1="5" y1="12" x2="19" y2="12"/>
                        </svg>
                        Create First Template
                    </button>
                </div>
            </div>
        </div>
        {% endif %}
    </main>
</div>
{% endblock %}

{% block extra_js %}
<script nonce="{{ request.csp_nonce }}">
document.addEventListener('DOMContentLoaded', function() {
    const mobileToggle = document.getElementById('mobile-toggle');
    const sidebar = document.getElementById('dashboard-sidebar');
    const overlay = document.getElementById('sidebar-overlay');
    
    if (mobileToggle) {
        mobileToggle.addEventListener('click', function() {
            sidebar.classList.toggle('open');
            overlay.classList.toggle('active');
        });
    }
    
    if (overlay) {
        overlay.addEventListener('click', function() {
            sidebar.classList.remove('open');
            overlay.classList.remove('active');
        });
    }
});
</script>
{% endblock %}
