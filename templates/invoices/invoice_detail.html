{% extends "base/layout-light.html" %}
{% load static %}
{% block title %}Invoice {{ invoice.invoice_id }}{% endblock %}
{% block body_class %}dashboard-light-page{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/dashboard-light.css' %}">
<style>
.invoice-detail-light {
    display: grid;
    grid-template-columns: 1fr 320px;
    gap: 32px;
}

@media (max-width: 1024px) {
    .invoice-detail-light {
        grid-template-columns: 1fr;
    }
}

.invoice-preview-light {
    background: var(--light-bg-secondary);
    border-radius: var(--light-radius-xl);
    border: 1px solid var(--light-border-primary);
    padding: 32px;
}

.invoice-meta-light {
    display: flex;
    gap: 32px;
    flex-wrap: wrap;
    padding-bottom: 24px;
    margin-bottom: 24px;
    border-bottom: 1px solid var(--light-border-primary);
}

.meta-item-light {
    display: flex;
    flex-direction: column;
    gap: 4px;
}

.meta-label-light {
    font-size: 0.75rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    color: var(--light-text-tertiary);
}

.meta-value-light {
    font-size: 0.9375rem;
    font-weight: 500;
    color: var(--light-text-primary);
}

.meta-value-light.overdue {
    color: var(--light-danger);
}

.invoice-parties-light {
    display: grid;
    grid-template-columns: 1fr auto 1fr;
    gap: 24px;
    align-items: start;
    margin-bottom: 32px;
}

@media (max-width: 768px) {
    .invoice-parties-light {
        grid-template-columns: 1fr;
    }
}

.party-card-light {
    padding: 20px;
    background: var(--light-bg-tertiary);
    border-radius: var(--light-radius-lg);
}

.party-header-light {
    display: flex;
    align-items: center;
    gap: 12px;
    margin-bottom: 16px;
}

.party-icon-light {
    width: 40px;
    height: 40px;
    border-radius: var(--light-radius-md);
    display: flex;
    align-items: center;
    justify-content: center;
}

.party-icon-light svg {
    width: 20px;
    height: 20px;
}

.party-icon-light.from {
    background: var(--light-primary-light);
}

.party-icon-light.from svg {
    stroke: var(--light-primary);
}

.party-icon-light.to {
    background: var(--light-success-light);
}

.party-icon-light.to svg {
    stroke: var(--light-success);
}

.party-label-light {
    font-size: 0.75rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    color: var(--light-text-tertiary);
}

.party-name-light {
    font-size: 1rem;
    font-weight: 600;
    color: var(--light-text-primary);
    margin: 0 0 8px 0;
}

.party-detail-light {
    font-size: 0.875rem;
    color: var(--light-text-secondary);
    margin: 0 0 4px 0;
}

.party-arrow-light {
    display: flex;
    align-items: center;
    justify-content: center;
    color: var(--light-text-muted);
}

.party-arrow-light svg {
    width: 24px;
    height: 24px;
}

@media (max-width: 768px) {
    .party-arrow-light {
        transform: rotate(90deg);
        margin: 8px 0;
    }
}

.items-section-light {
    margin-bottom: 24px;
}

.items-title-light {
    font-size: 0.875rem;
    font-weight: 600;
    color: var(--light-text-primary);
    margin: 0 0 16px 0;
}

.items-table-light {
    width: 100%;
    border-collapse: collapse;
}

.items-table-light th {
    text-align: left;
    padding: 12px 16px;
    font-size: 0.75rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    color: var(--light-text-tertiary);
    background: var(--light-bg-tertiary);
    border-bottom: 1px solid var(--light-border-primary);
}

.items-table-light th:last-child {
    text-align: right;
}

.items-table-light td {
    padding: 16px;
    font-size: 0.9375rem;
    color: var(--light-text-secondary);
    border-bottom: 1px solid var(--light-border-primary);
}

.items-table-light td:first-child {
    font-weight: 500;
    color: var(--light-text-primary);
}

.items-table-light td:last-child {
    text-align: right;
    font-weight: 600;
}

.invoice-summary-light {
    padding: 24px;
    background: var(--light-bg-tertiary);
    border-radius: var(--light-radius-lg);
    margin-bottom: 24px;
}

.summary-row-light {
    display: flex;
    justify-content: space-between;
    padding: 8px 0;
    font-size: 0.9375rem;
}

.summary-row-light.total {
    border-top: 2px solid var(--light-border-primary);
    margin-top: 8px;
    padding-top: 16px;
    font-size: 1.25rem;
    font-weight: 700;
    color: var(--light-text-primary);
}

.invoice-notes-light {
    padding: 20px;
    background: var(--light-bg-tertiary);
    border-radius: var(--light-radius-lg);
}

.notes-title-light {
    font-size: 0.875rem;
    font-weight: 600;
    color: var(--light-text-primary);
    margin: 0 0 12px 0;
}

.notes-content-light {
    font-size: 0.9375rem;
    color: var(--light-text-secondary);
    line-height: 1.6;
    margin: 0;
}

.invoice-actions-light {
    background: var(--light-bg-secondary);
    border-radius: var(--light-radius-xl);
    border: 1px solid var(--light-border-primary);
    padding: 24px;
    height: fit-content;
    position: sticky;
    top: 24px;
}

.actions-title-light {
    font-size: 1rem;
    font-weight: 600;
    color: var(--light-text-primary);
    margin: 0 0 20px 0;
}

.status-card-light {
    padding: 16px;
    background: var(--light-bg-tertiary);
    border-radius: var(--light-radius-lg);
    margin-bottom: 20px;
}

.status-label-light {
    font-size: 0.75rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    color: var(--light-text-tertiary);
    margin-bottom: 8px;
}

.status-value-light {
    font-size: 1.25rem;
    font-weight: 700;
}

.status-value-light.paid {
    color: var(--light-success);
}

.status-value-light.unpaid {
    color: var(--light-warning);
}

.status-value-light.overdue {
    color: var(--light-danger);
}

.actions-list-light {
    display: flex;
    flex-direction: column;
    gap: 12px;
}

.status-form-light {
    padding: 16px;
    background: var(--light-bg-tertiary);
    border-radius: var(--light-radius-lg);
    margin-bottom: 20px;
}

.status-form-light label {
    display: block;
    font-size: 0.75rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    color: var(--light-text-tertiary);
    margin-bottom: 8px;
}

.status-form-light select {
    width: 100%;
    padding: 10px 12px;
    font-size: 0.875rem;
    border: 1px solid var(--light-border-primary);
    border-radius: var(--light-radius-md);
    background: var(--light-bg-secondary);
    margin-bottom: 12px;
}

.back-light-link {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    font-size: 0.875rem;
    color: var(--light-text-secondary);
    text-decoration: none;
    margin-bottom: 16px;
}

.back-light-link:hover {
    color: var(--light-primary);
}

.back-light-link svg {
    width: 16px;
    height: 16px;
}

.invoice-header-light {
    display: flex;
    align-items: center;
    gap: 16px;
    margin-bottom: 8px;
    flex-wrap: wrap;
}
</style>
{% endblock %}

{% block nav %}{% endblock %}
{% block footer %}{% endblock %}

{% block content %}
<div class="dashboard-layout">
    {% include 'components/sidebar-light.html' with active='invoices' %}
    
    <main class="dashboard-main">
        <a href="{% url 'invoice_list' %}" class="back-light-link">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <line x1="19" y1="12" x2="5" y2="12"/>
                <polyline points="12 19 5 12 12 5"/>
            </svg>
            Back to Invoices
        </a>
        
        <header class="dashboard-light-header">
            <div class="dashboard-light-header-content">
                <div class="invoice-header-light">
                    <h1>{{ invoice.invoice_id }}</h1>
                    <span class="badge-light badge-{{ invoice.status }}">{{ invoice.get_status_display }}</span>
                </div>
                <p>Created on {{ invoice.created_at|date:"F d, Y" }}</p>
            </div>
            <div class="dashboard-light-actions" style="display: flex; gap: 12px;">
                <a href="{% url 'edit_invoice' invoice.id %}" class="btn-light-secondary">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/>
                        <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/>
                    </svg>
                    Edit
                </a>
                <a href="{% url 'generate_pdf' invoice.id %}" class="btn-light-primary">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                        <polyline points="7 10 12 15 17 10"/>
                        <line x1="12" y1="15" x2="12" y2="3"/>
                    </svg>
                    Download PDF
                </a>
            </div>
        </header>
        
        <div class="invoice-detail-light">
            <div class="invoice-preview-light">
                <div class="invoice-meta-light">
                    <div class="meta-item-light">
                        <span class="meta-label-light">Invoice Date</span>
                        <span class="meta-value-light">{{ invoice.invoice_date|date:"F d, Y" }}</span>
                    </div>
                    <div class="meta-item-light">
                        <span class="meta-label-light">Due Date</span>
                        <span class="meta-value-light {% if invoice.is_overdue %}overdue{% endif %}">
                            {{ invoice.due_date|date:"F d, Y" }}
                            {% if invoice.is_overdue %}<span style="margin-left: 8px; padding: 2px 8px; background: var(--light-danger-light); color: var(--light-danger); border-radius: 999px; font-size: 0.75rem;">Overdue</span>{% endif %}
                        </span>
                    </div>
                    <div class="meta-item-light">
                        <span class="meta-label-light">Currency</span>
                        <span class="meta-value-light">{{ invoice.currency }}</span>
                    </div>
                </div>
                
                <div class="invoice-parties-light">
                    <div class="party-card-light">
                        <div class="party-header-light">
                            <div class="party-icon-light from">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"/>
                                </svg>
                            </div>
                            <span class="party-label-light">From</span>
                        </div>
                        <h3 class="party-name-light">{{ invoice.business_name }}</h3>
                        {% if invoice.business_email %}<p class="party-detail-light">{{ invoice.business_email }}</p>{% endif %}
                        {% if invoice.business_phone %}<p class="party-detail-light">{{ invoice.business_phone }}</p>{% endif %}
                        {% if invoice.business_address %}<p class="party-detail-light">{{ invoice.business_address|linebreaksbr }}</p>{% endif %}
                    </div>
                    
                    <div class="party-arrow-light">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="5" y1="12" x2="19" y2="12"/>
                            <polyline points="12 5 19 12 12 19"/>
                        </svg>
                    </div>
                    
                    <div class="party-card-light">
                        <div class="party-header-light">
                            <div class="party-icon-light to">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
                                    <circle cx="12" cy="7" r="4"/>
                                </svg>
                            </div>
                            <span class="party-label-light">To</span>
                        </div>
                        <h3 class="party-name-light">{{ invoice.client_name }}</h3>
                        {% if invoice.client_email %}<p class="party-detail-light">{{ invoice.client_email }}</p>{% endif %}
                        {% if invoice.client_phone %}<p class="party-detail-light">{{ invoice.client_phone }}</p>{% endif %}
                        {% if invoice.client_address %}<p class="party-detail-light">{{ invoice.client_address|linebreaksbr }}</p>{% endif %}
                    </div>
                </div>
                
                <div class="items-section-light">
                    <h3 class="items-title-light">Line Items</h3>
                    <table class="items-table-light">
                        <thead>
                            <tr>
                                <th>Description</th>
                                <th>Qty</th>
                                <th>Unit Price</th>
                                <th>Total</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for item in invoice.line_items.all %}
                            <tr>
                                <td>{{ item.description }}</td>
                                <td>{{ item.quantity }}</td>
                                <td>{{ invoice.currency }} {{ item.unit_price|floatformat:2 }}</td>
                                <td>{{ invoice.currency }} {{ item.total|floatformat:2 }}</td>
                            </tr>
                            {% empty %}
                            <tr>
                                <td colspan="4" style="text-align: center; color: var(--light-text-muted);">No line items</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                
                <div class="invoice-summary-light">
                    <div class="summary-row-light">
                        <span>Subtotal</span>
                        <span>{{ invoice.currency }} {{ invoice.subtotal|floatformat:2 }}</span>
                    </div>
                    <div class="summary-row-light">
                        <span>Tax ({{ invoice.tax_rate }}%)</span>
                        <span>{{ invoice.currency }} {{ invoice.tax_amount|floatformat:2 }}</span>
                    </div>
                    <div class="summary-row-light total">
                        <span>Total</span>
                        <span>{{ invoice.currency }} {{ invoice.total|floatformat:2 }}</span>
                    </div>
                </div>
                
                {% if invoice.notes %}
                <div class="invoice-notes-light">
                    <h3 class="notes-title-light">Notes</h3>
                    <p class="notes-content-light">{{ invoice.notes|linebreaksbr }}</p>
                </div>
                {% endif %}
            </div>
            
            <div class="invoice-actions-light">
                <h3 class="actions-title-light">Actions</h3>
                
                <div class="status-card-light">
                    <div class="status-label-light">Current Status</div>
                    <div class="status-value-light {{ invoice.status }}">{{ invoice.get_status_display }}</div>
                </div>
                
                <form method="post" action="{% url 'update_invoice_status' invoice.id %}" class="status-form-light">
                    {% csrf_token %}
                    <label>Update Status</label>
                    <select name="status">
                        <option value="unpaid" {% if invoice.status == 'unpaid' %}selected{% endif %}>Unpaid</option>
                        <option value="paid" {% if invoice.status == 'paid' %}selected{% endif %}>Paid</option>
                    </select>
                    <button type="submit" class="btn-light-primary btn-light-block">Update Status</button>
                </form>
                
                <div class="actions-list-light">
                    <a href="{% url 'send_invoice_email' invoice.id %}" class="btn-light-secondary btn-light-block">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width: 18px; height: 18px;">
                            <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/>
                            <polyline points="22,6 12,13 2,6"/>
                        </svg>
                        Send via Email
                    </a>
                    <a href="{% url 'whatsapp_share' invoice.id %}" target="_blank" class="btn-light-secondary btn-light-block">
                        <svg viewBox="0 0 24 24" fill="currentColor" style="width: 18px; height: 18px;">
                            <path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347"/>
                        </svg>
                        Share on WhatsApp
                    </a>
                    <a href="{% url 'delete_invoice' invoice.id %}" class="btn-light-danger btn-light-block">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width: 18px; height: 18px;">
                            <polyline points="3 6 5 6 21 6"/>
                            <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
                        </svg>
                        Delete Invoice
                    </a>
                </div>
            </div>
        </div>
        
        {% include 'components/dashboard-footer.html' %}
    </main>
</div>
{% endblock %}

{% block extra_js %}
<script nonce="{{ request.csp_nonce }}">
document.addEventListener('DOMContentLoaded', function() {
    const mobileToggle = document.getElementById('mobile-toggle');
    const sidebar = document.getElementById('dashboard-sidebar');
    const overlay = document.getElementById('sidebar-overlay');
    
    if (mobileToggle) {
        mobileToggle.addEventListener('click', function() {
            sidebar.classList.toggle('open');
            overlay.classList.toggle('active');
        });
    }
    
    if (overlay) {
        overlay.addEventListener('click', function() {
            sidebar.classList.remove('open');
            overlay.classList.remove('active');
        });
    }
});
</script>
{% endblock %}
