{% extends "base/layout-light.html" %}
{% load static %}
{% block title %}Recurring Invoices{% endblock %}
{% block body_class %}dashboard-light-page{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/dashboard-light.css' %}">
<style>
.recurring-grid-light {
    display: grid;
    grid-template-columns: 1fr 380px;
    gap: 32px;
}

@media (max-width: 1024px) {
    .recurring-grid-light {
        grid-template-columns: 1fr;
    }
}

.recurring-card-light {
    background: var(--light-bg-secondary);
    border-radius: var(--light-radius-xl);
    border: 1px solid var(--light-border-primary);
    padding: 24px;
    margin-bottom: 16px;
    transition: all 0.3s ease;
}

.recurring-card-light:hover {
    border-color: var(--light-primary);
    box-shadow: var(--light-shadow-md);
}

.recurring-header-light {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 16px;
}

.recurring-client-light {
    font-size: 1.125rem;
    font-weight: 600;
    color: var(--light-text-primary);
    margin: 0 0 4px 0;
}

.recurring-schedule-light {
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: 0.875rem;
    color: var(--light-text-tertiary);
}

.recurring-schedule-light svg {
    width: 16px;
    height: 16px;
}

.recurring-details-light {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 16px;
    margin-bottom: 16px;
}

.recurring-detail-light {
    padding: 12px;
    background: var(--light-bg-tertiary);
    border-radius: var(--light-radius-md);
}

.recurring-detail-label-light {
    font-size: 0.75rem;
    color: var(--light-text-muted);
    margin-bottom: 4px;
}

.recurring-detail-value-light {
    font-size: 0.9375rem;
    font-weight: 600;
    color: var(--light-text-primary);
}

.recurring-actions-light {
    display: flex;
    gap: 8px;
    padding-top: 16px;
    border-top: 1px solid var(--light-border-primary);
}

.recurring-form-light {
    background: var(--light-bg-secondary);
    border-radius: var(--light-radius-xl);
    border: 1px solid var(--light-border-primary);
    padding: 24px;
    height: fit-content;
    position: sticky;
    top: 24px;
}

.recurring-form-title-light {
    font-size: 1.125rem;
    font-weight: 600;
    color: var(--light-text-primary);
    margin: 0 0 24px 0;
}

.frequency-options-light {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 8px;
    margin-bottom: 20px;
}

.frequency-option-light {
    padding: 12px 16px;
    background: var(--light-bg-tertiary);
    border: 2px solid transparent;
    border-radius: var(--light-radius-md);
    cursor: pointer;
    text-align: center;
    transition: all 0.2s ease;
}

.frequency-option-light:hover {
    border-color: var(--light-border-secondary);
}

.frequency-option-light input {
    display: none;
}

.frequency-option-light input:checked + .frequency-label-light {
    color: var(--light-primary);
}

.frequency-option-light:has(input:checked) {
    background: var(--light-primary-light);
    border-color: var(--light-primary);
}

.frequency-label-light {
    font-size: 0.875rem;
    font-weight: 500;
    color: var(--light-text-secondary);
}
</style>
{% endblock %}

{% block nav %}{% endblock %}
{% block footer %}{% endblock %}

{% block content %}
<div class="dashboard-layout">
    {% include 'components/sidebar-light.html' with active='recurring' %}
    
    <main class="dashboard-main">
        <header class="dashboard-light-header">
            <div class="dashboard-light-header-content">
                <h1>Recurring Invoices</h1>
                <p>Automate your billing with scheduled invoice generation</p>
            </div>
        </header>
        
        <div class="recurring-grid-light">
            <div class="recurring-list-light">
                {% if recurring_invoices %}
                {% for recurring in recurring_invoices %}
                <div class="recurring-card-light">
                    <div class="recurring-header-light">
                        <div>
                            <h3 class="recurring-client-light">{{ recurring.client_name }}</h3>
                            <div class="recurring-schedule-light">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <polyline points="23 4 23 10 17 10"/>
                                    <polyline points="1 20 1 14 7 14"/>
                                    <path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"/>
                                </svg>
                                {{ recurring.get_frequency_display }}
                            </div>
                        </div>
                        {% if recurring.is_active %}
                        <span class="badge-light badge-paid">Active</span>
                        {% else %}
                        <span class="badge-light badge-draft">Paused</span>
                        {% endif %}
                    </div>
                    
                    <div class="recurring-details-light">
                        <div class="recurring-detail-light">
                            <div class="recurring-detail-label-light">Amount</div>
                            <div class="recurring-detail-value-light">{{ recurring.currency }} {{ recurring.amount|floatformat:2 }}</div>
                        </div>
                        <div class="recurring-detail-light">
                            <div class="recurring-detail-label-light">Next Invoice</div>
                            <div class="recurring-detail-value-light">{{ recurring.next_date|date:"M d, Y" }}</div>
                        </div>
                        <div class="recurring-detail-light">
                            <div class="recurring-detail-label-light">Generated</div>
                            <div class="recurring-detail-value-light">{{ recurring.invoices_generated }}</div>
                        </div>
                    </div>
                    
                    <div class="recurring-actions-light">
                        {% if recurring.is_active %}
                        <a href="{% url 'pause_recurring' recurring.id %}" class="btn-light-secondary" style="flex: 1;">Pause</a>
                        {% else %}
                        <a href="{% url 'resume_recurring' recurring.id %}" class="btn-light-primary" style="flex: 1;">Resume</a>
                        {% endif %}
                        <a href="{% url 'edit_recurring' recurring.id %}" class="btn-light-secondary" style="flex: 1;">Edit</a>
                        <a href="{% url 'delete_recurring' recurring.id %}" class="btn-light-danger" style="flex: 1;">Delete</a>
                    </div>
                </div>
                {% endfor %}
                {% else %}
                <div class="card-light">
                    <div class="card-light-body">
                        <div class="empty-light-state">
                            <div class="empty-light-icon">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                    <polyline points="23 4 23 10 17 10"/>
                                    <polyline points="1 20 1 14 7 14"/>
                                    <path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"/>
                                </svg>
                            </div>
                            <h3 class="empty-light-title">No recurring invoices</h3>
                            <p class="empty-light-description">Set up automated billing to save time on regular invoices.</p>
                        </div>
                    </div>
                </div>
                {% endif %}
            </div>
            
            <div class="recurring-form-light">
                <h2 class="recurring-form-title-light">Create Recurring Invoice</h2>
                
                <form method="post">
                    {% csrf_token %}
                    
                    <div class="form-light-group">
                        <label class="form-light-label">Client Name</label>
                        <input type="text" name="client_name" class="form-light-input" required>
                    </div>
                    
                    <div class="form-light-group" style="margin-top: 16px;">
                        <label class="form-light-label">Client Email</label>
                        <input type="email" name="client_email" class="form-light-input">
                    </div>
                    
                    <div class="form-light-group" style="margin-top: 16px;">
                        <label class="form-light-label">Amount</label>
                        <input type="number" name="amount" class="form-light-input" step="0.01" min="0" required>
                    </div>
                    
                    <div class="form-light-group" style="margin-top: 16px;">
                        <label class="form-light-label">Currency</label>
                        <select name="currency" class="form-light-select">
                            <option value="USD">USD ($)</option>
                            <option value="EUR">EUR (&euro;)</option>
                            <option value="GBP">GBP (&pound;)</option>
                            <option value="NGN">NGN (&#8358;)</option>
                        </select>
                    </div>
                    
                    <div class="form-light-group" style="margin-top: 16px;">
                        <label class="form-light-label">Frequency</label>
                        <div class="frequency-options-light">
                            <label class="frequency-option-light">
                                <input type="radio" name="frequency" value="weekly">
                                <span class="frequency-label-light">Weekly</span>
                            </label>
                            <label class="frequency-option-light">
                                <input type="radio" name="frequency" value="biweekly">
                                <span class="frequency-label-light">Bi-weekly</span>
                            </label>
                            <label class="frequency-option-light">
                                <input type="radio" name="frequency" value="monthly" checked>
                                <span class="frequency-label-light">Monthly</span>
                            </label>
                            <label class="frequency-option-light">
                                <input type="radio" name="frequency" value="quarterly">
                                <span class="frequency-label-light">Quarterly</span>
                            </label>
                        </div>
                    </div>
                    
                    <div class="form-light-group" style="margin-top: 16px;">
                        <label class="form-light-label">Start Date</label>
                        <input type="date" name="start_date" class="form-light-input" required>
                    </div>
                    
                    <div class="form-light-group" style="margin-top: 16px;">
                        <label class="form-light-label">Description</label>
                        <textarea name="description" class="form-light-textarea" rows="3" placeholder="Invoice description..."></textarea>
                    </div>
                    
                    <div style="margin-top: 24px;">
                        <button type="submit" class="btn-light-primary btn-light-block">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width: 18px; height: 18px;">
                                <polyline points="23 4 23 10 17 10"/>
                                <path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"/>
                            </svg>
                            Create Recurring Invoice
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </main>
</div>
{% endblock %}

{% block extra_js %}
<script nonce="{{ request.csp_nonce }}">
document.addEventListener('DOMContentLoaded', function() {
    const mobileToggle = document.getElementById('mobile-toggle');
    const sidebar = document.getElementById('dashboard-sidebar');
    const overlay = document.getElementById('sidebar-overlay');
    
    if (mobileToggle) {
        mobileToggle.addEventListener('click', function() {
            sidebar.classList.toggle('open');
            overlay.classList.toggle('active');
        });
    }
    
    if (overlay) {
        overlay.addEventListener('click', function() {
            sidebar.classList.remove('open');
            overlay.classList.remove('active');
        });
    }
});
</script>
{% endblock %}
