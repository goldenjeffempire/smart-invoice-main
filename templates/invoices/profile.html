{% extends "base/layout-light.html" %}
{% load static %}
{% block title %}Profile Settings{% endblock %}
{% block body_class %}dashboard-light-page{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/dashboard-light.css' %}">
<style>
.profile-form-light {
    max-width: 800px;
}

.section-light {
    background: var(--light-bg-secondary);
    border-radius: var(--light-radius-xl);
    border: 1px solid var(--light-border-primary);
    padding: 24px;
    margin-bottom: 24px;
}

.section-light-header {
    display: flex;
    align-items: center;
    gap: 16px;
    margin-bottom: 24px;
    padding-bottom: 16px;
    border-bottom: 1px solid var(--light-border-primary);
}

.section-light-icon {
    width: 48px;
    height: 48px;
    border-radius: var(--light-radius-lg);
    display: flex;
    align-items: center;
    justify-content: center;
}

.section-light-icon svg {
    width: 24px;
    height: 24px;
}

.section-light-icon.icon-business {
    background: var(--light-primary-light);
}

.section-light-icon.icon-business svg {
    stroke: var(--light-primary);
}

.section-light-icon.icon-defaults {
    background: var(--light-accent-light);
}

.section-light-icon.icon-defaults svg {
    stroke: var(--light-accent);
}

.section-light-title {
    font-size: 1.125rem;
    font-weight: 600;
    color: var(--light-text-primary);
    margin: 0 0 4px 0;
}

.section-light-desc {
    font-size: 0.875rem;
    color: var(--light-text-tertiary);
    margin: 0;
}

.form-light-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 20px;
}

.form-light-grid-3 {
    grid-template-columns: repeat(3, 1fr);
}

@media (max-width: 768px) {
    .form-light-grid,
    .form-light-grid-3 {
        grid-template-columns: 1fr;
    }
}

.form-light-group.full-width {
    grid-column: 1 / -1;
}

.logo-upload-light {
    display: flex;
    gap: 24px;
    margin-bottom: 24px;
    padding: 20px;
    background: var(--light-bg-tertiary);
    border-radius: var(--light-radius-lg);
    align-items: center;
}

@media (max-width: 640px) {
    .logo-upload-light {
        flex-direction: column;
        text-align: center;
    }
}

.logo-preview-light {
    width: 80px;
    height: 80px;
    border-radius: var(--light-radius-lg);
    overflow: hidden;
    flex-shrink: 0;
    background: var(--light-bg-secondary);
    border: 1px solid var(--light-border-primary);
}

.logo-preview-light img {
    width: 100%;
    height: 100%;
    object-fit: cover;
}

.logo-placeholder-light {
    width: 100%;
    height: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
    color: var(--light-text-muted);
}

.logo-placeholder-light svg {
    width: 32px;
    height: 32px;
}

.logo-info-light {
    flex: 1;
}

.logo-title-light {
    font-size: 1rem;
    font-weight: 600;
    color: var(--light-text-primary);
    margin: 0 0 4px 0;
}

.logo-desc-light {
    font-size: 0.875rem;
    color: var(--light-text-tertiary);
    margin: 0 0 12px 0;
}

.upload-btn-light {
    display: inline-block;
    cursor: pointer;
}

.upload-btn-light input {
    display: none;
}

.form-light-hint {
    font-size: 0.75rem;
    color: var(--light-text-muted);
    margin-top: 4px;
}

.form-actions-light {
    display: flex;
    justify-content: flex-end;
    gap: 16px;
    margin-top: 32px;
    padding-top: 24px;
    border-top: 1px solid var(--light-border-primary);
}

.message-light {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 16px;
    border-radius: var(--light-radius-lg);
    margin-bottom: 24px;
}

.message-light svg {
    width: 20px;
    height: 20px;
    flex-shrink: 0;
}

.message-light.success {
    background: var(--light-success-light);
    border: 1px solid var(--light-success);
    color: var(--light-success-dark);
}

.message-light.error {
    background: var(--light-danger-light);
    border: 1px solid var(--light-danger);
    color: var(--light-danger-dark);
}

.back-light-link {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    font-size: 0.875rem;
    color: var(--light-text-secondary);
    text-decoration: none;
    margin-bottom: 16px;
}

.back-light-link:hover {
    color: var(--light-primary);
}

.back-light-link svg {
    width: 16px;
    height: 16px;
}
</style>
{% endblock %}

{% block nav %}{% endblock %}
{% block footer %}{% endblock %}

{% block content %}
<div class="dashboard-layout">
    {% include 'components/sidebar-light.html' with active='settings' %}
    
    <main class="dashboard-main">
        <a href="{% url 'settings' %}" class="back-light-link">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <line x1="19" y1="12" x2="5" y2="12"/>
                <polyline points="12 19 5 12 12 5"/>
            </svg>
            Back to Settings
        </a>
        
        <header class="dashboard-light-header">
            <div class="dashboard-light-header-content">
                <h1>Profile Settings</h1>
                <p>Manage your business information and preferences</p>
            </div>
        </header>
        
        {% if messages %}
        {% for message in messages %}
        <div class="message-light {{ message.tags }}">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                {% if message.tags == 'success' %}
                <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/>
                <polyline points="22 4 12 14.01 9 11.01"/>
                {% else %}
                <circle cx="12" cy="12" r="10"/>
                <line x1="12" y1="8" x2="12" y2="12"/>
                <line x1="12" y1="16" x2="12.01" y2="16"/>
                {% endif %}
            </svg>
            <span>{{ message }}</span>
        </div>
        {% endfor %}
        {% endif %}
        
        <form method="post" enctype="multipart/form-data" class="profile-form-light">
            {% csrf_token %}
            
            <div class="section-light">
                <div class="section-light-header">
                    <div class="section-light-icon icon-business">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"/>
                        </svg>
                    </div>
                    <div>
                        <h2 class="section-light-title">Business Information</h2>
                        <p class="section-light-desc">This information will appear on your invoices</p>
                    </div>
                </div>
                
                <div class="logo-upload-light">
                    <div class="logo-preview-light">
                        {% if profile.company_logo %}
                        <img src="{{ profile.company_logo.url }}" alt="Company Logo" id="logo-img">
                        {% else %}
                        <div class="logo-placeholder-light" id="logo-placeholder">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
                                <circle cx="8.5" cy="8.5" r="1.5"/>
                                <polyline points="21 15 16 10 5 21"/>
                            </svg>
                        </div>
                        {% endif %}
                    </div>
                    <div class="logo-info-light">
                        <h3 class="logo-title-light">Company Logo</h3>
                        <p class="logo-desc-light">Upload a logo to display on your invoices. PNG or JPG, max 2MB.</p>
                        <label class="upload-btn-light">
                            <input type="file" name="company_logo" accept="image/*" id="logo-input">
                            <span class="btn-light-secondary" style="padding: 8px 16px; font-size: 0.875rem;">Choose File</span>
                        </label>
                    </div>
                </div>
                
                <div class="form-light-grid">
                    <div class="form-light-group full-width">
                        <label class="form-light-label">Company Name</label>
                        {{ form.company_name }}
                    </div>
                    <div class="form-light-group">
                        <label class="form-light-label">Business Email</label>
                        {{ form.business_email }}
                    </div>
                    <div class="form-light-group">
                        <label class="form-light-label">Business Phone</label>
                        {{ form.business_phone }}
                    </div>
                    <div class="form-light-group full-width">
                        <label class="form-light-label">Business Address</label>
                        {{ form.business_address }}
                    </div>
                </div>
            </div>
            
            <div class="section-light">
                <div class="section-light-header">
                    <div class="section-light-icon icon-defaults">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="3"/>
                            <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/>
                        </svg>
                    </div>
                    <div>
                        <h2 class="section-light-title">Invoice Defaults</h2>
                        <p class="section-light-desc">Set default values for new invoices</p>
                    </div>
                </div>
                
                <div class="form-light-grid form-light-grid-3">
                    <div class="form-light-group">
                        <label class="form-light-label">Default Currency</label>
                        {{ form.default_currency }}
                    </div>
                    <div class="form-light-group">
                        <label class="form-light-label">Default Tax Rate (%)</label>
                        {{ form.default_tax_rate }}
                    </div>
                    <div class="form-light-group">
                        <label class="form-light-label">Invoice Prefix</label>
                        {{ form.invoice_prefix }}
                        <span class="form-light-hint">e.g., INV-001, PROJ-001</span>
                    </div>
                </div>
            </div>
            
            <div class="form-actions-light">
                <a href="{% url 'settings' %}" class="btn-light-secondary">Cancel</a>
                <button type="submit" class="btn-light-primary">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/>
                        <polyline points="17 21 17 13 7 13 7 21"/>
                        <polyline points="7 3 7 8 15 8"/>
                    </svg>
                    Save Changes
                </button>
            </div>
        </form>
    </main>
</div>
{% endblock %}

{% block extra_js %}
<script nonce="{{ request.csp_nonce }}">
document.addEventListener('DOMContentLoaded', function() {
    const mobileToggle = document.getElementById('mobile-toggle');
    const sidebar = document.getElementById('dashboard-sidebar');
    const overlay = document.getElementById('sidebar-overlay');
    
    if (mobileToggle) {
        mobileToggle.addEventListener('click', function() {
            sidebar.classList.toggle('open');
            overlay.classList.toggle('active');
        });
    }
    
    if (overlay) {
        overlay.addEventListener('click', function() {
            sidebar.classList.remove('open');
            overlay.classList.remove('active');
        });
    }
    
    const logoInput = document.getElementById('logo-input');
    const logoImg = document.getElementById('logo-img');
    const logoPlaceholder = document.getElementById('logo-placeholder');
    
    if (logoInput) {
        logoInput.addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    if (logoPlaceholder) {
                        logoPlaceholder.style.display = 'none';
                    }
                    
                    let img = logoImg;
                    if (!img) {
                        img = document.createElement('img');
                        img.id = 'logo-img';
                        document.querySelector('.logo-preview-light').appendChild(img);
                    }
                    img.src = e.target.result;
                    img.alt = 'Company Logo';
                    img.style.display = 'block';
                };
                reader.readAsDataURL(file);
            }
        });
    }
});
</script>
{% endblock %}
